name: YAKA UI Static Analysis Pipeline

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

permissions:
  contents: write
  actions: read

jobs:
  analyze:
    name: Static Code Analysis + Auto-fix
    runs-on: ubuntu-latest

    steps:
      # Checkout repository
      - name: Checkout
        uses: actions/checkout@v4

      # Setup Node
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # Install dependencies
      - name: Install dependencies
        run: |
          npm init -y
          npm install eslint htmlhint stylelint stylelint-config-standard prettier --save-dev

      # Run HTMLHint (HTML linter)
      - name: Run HTMLHint
        run: npx htmlhint "**/*.html" || true

      # Run ESLint with auto-fix (JS linter)
      - name: Run ESLint Auto-fix
        run: npx eslint . --fix || true

      # Run Stylelint with auto-fix (CSS linter)
      - name: Run Stylelint Auto-fix
        run: npx stylelint "**/*.css" --fix || true

      # Run Prettier to format all files
      - name: Prettier Auto-format
        run: npx prettier --write "**/*.{js,html,css}" || true

      # Commit fixes if any
      - name: Commit and Push Auto-fixes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git diff --cached --quiet || git commit -m "chore: Auto-fix HTML/JS/CSS via linters & Prettier"
          git push origin HEAD:main || true
